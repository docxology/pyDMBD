# Theoretical Foundations of Dynamic Markov Blanket Detection

## Introduction to Markov Blankets

A Markov blanket of a node in a Bayesian network is the set of nodes that shield the node from the rest of the network. More formally, a Markov blanket of a node X consists of:

1. The direct parents of X
2. The direct children of X
3. The other parents of X's direct children

When we know the values of all the variables in the Markov blanket of X, the probability distribution of X is independent of all other variables in the network. This concept is fundamental to understanding how we can identify subsystems within a larger system.

## Dynamic Markov Blankets

The concept of a Markov blanket can be extended to dynamical systems. In a dynamical system, a set of variables forms a Markov blanket around another set if the latter's evolution depends only on its own state and the state of its blanket, not on the rest of the system.

Formally, if we partition a dynamical system's state variables into three sets:
- External (environment) variables: $s$
- Boundary variables: $b$
- Internal (system) variables: $z$

Then $b$ forms a Markov blanket around $z$ if the following conditional independence relationships hold:

$$p(z_{t+1} | z_t, b_t, s_t) = p(z_{t+1} | z_t, b_t)$$
$$p(s_{t+1} | z_t, b_t, s_t) = p(s_{t+1} | b_t, s_t)$$

In other words, the future state of internal variables depends only on current internal and boundary variables, while the future state of external variables depends only on current external and boundary variables.

## The DMBD Algorithm

The Dynamic Markov Blanket Detection (DMBD) algorithm is designed to discover these partitions in time-series data. It models the data as being generated by a latent linear dynamical system with Markov blanket structure:

$$x_{t+1} = Ax_t + Bu_t + w_t$$

Where $x_t = (s_t, b_t, z_t)$ is the partition of latent variables, and the dynamics matrix $A$ is constrained to have a specific block structure:

$$A = \begin{pmatrix}
A_{ss} & A_{sb} & 0 \\
A_{bs} & A_{bb} & A_{bz} \\
0 & A_{zb} & A_{zz}
\end{pmatrix}$$

This structure enforces the Markov blanket condition by ensuring that there are no direct interactions between internal and external variables.

## Observation Model

Each observable $y_i$ is assumed to be generated by one of the three components of the latent state, depending on its assignment $\lambda_i$:

$$y_i[t] = C_{\lambda_i[t]} x[t] + D_{\lambda_i[t]} r[t] + v_{\lambda_i[t]}$$

Where:
- $\lambda_i[t]$ indicates whether observable $i$ at time $t$ is part of the environment, boundary, or system
- $C_{\lambda_i[t]}$ is the emission matrix corresponding to assignment $\lambda_i[t]$
- $D_{\lambda_i[t]}$ is the regression matrix for additional covariates $r[t]$
- $v_{\lambda_i[t]}$ is the observation noise

## Roles and Assignment Dynamics

To capture non-linear relationships and allow for objects to change over time (e.g., exchange matter with environment), DMBD introduces:

1. **Roles**: Each component (environment, boundary, system) can have multiple roles, each with its own emission matrix but with the same masking structure.

2. **Assignment Dynamics**: The assignments $\lambda_i[t]$ evolve according to a Hidden Markov Model with transition dynamics that respect the Markov blanket structure:

$$p(\lambda_i[t+1] | \lambda_i[t]) = \begin{pmatrix}
T_{ss} & T_{sb} & 0 \\
T_{bs} & T_{bb} & T_{bz} \\
0 & T_{zb} & T_{zz}
\end{pmatrix}$$

This prevents direct transitions between environment and system, enforcing the boundary's role as a mediator.

## Inference

DMBD uses variational message passing with a factorized posterior:

$$q(x, \lambda) = q(x)q(\lambda)$$

Where:
- $q(x)$ is a Gaussian distribution over latent states
- $q(\lambda) = \prod_i q(\lambda_i)$ factorizes over observables

The variational parameters are updated using coordinate ascent to maximize the evidence lower bound (ELBO):

$$\mathcal{L} = \mathbb{E}_{q(x, \lambda)}[\log p(y, x, \lambda)] - \mathbb{E}_{q(x, \lambda)}[\log q(x, \lambda)]$$

## Multiple Objects Extension

DMBD can be extended to discover multiple objects by partitioning the latent space into:
- One shared environment state ($s$)
- Multiple boundary states ($b_1, b_2, \ldots$)
- Multiple internal states ($z_1, z_2, \ldots$)

Each with their own Markov blanket structure.

## Summary

Dynamic Markov Blanket Detection provides a principled way to discover macroscopic objects from microscopic observations. By leveraging the Markov blanket formalism and variational inference, it can identify coherent subsystems that maintain conditional independence relationships over time, a key signature of self-organizing systems.

For a deeper mathematical treatment, see:
- [Mathematical Details](math_details.md)
- [Variational Inference](variational_inference.md)
- [Multiple Objects](multiple_objects.md) 